language: go

go:
  - 1.14.x

git:
  depth: false
  quiet: true
  submodules: false

services:
  - docker

script:
  - "make test"
  - "VERSION=$TRAVIS_BUILD_NUMBER make image"

after_success:
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then
    docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD ;
    VERSION=$TRAVIS_BUILD_NUMBER make push-image ;
    fi
